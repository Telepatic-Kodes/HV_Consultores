# Plan 06-01: Production Deployment — Security, Health, Error Pages

## Phase: 6 — Production Deployment
## Requirements: DEPL-01, DEPL-02, DEPL-03, DEPL-04, DEPL-05, DEPL-06

## Goal
Prepare application for production deployment with security headers, health monitoring, and branded error pages.

## Tasks Completed

### Task 1: Security headers via next.config.js (DEPL-03)
- Added `X-Frame-Options: DENY` — prevents clickjacking
- Added `X-Content-Type-Options: nosniff` — prevents MIME-type sniffing
- Added `Referrer-Policy: strict-origin-when-cross-origin`
- Added `X-DNS-Prefetch-Control: on` — faster external DNS resolution
- Added `Strict-Transport-Security: max-age=31536000; includeSubDomains` (HSTS)
- Added `Permissions-Policy: camera=(), microphone=(), geolocation=()`
- Added `Content-Security-Policy` — restricts script/style/connect sources
  - Allows Convex cloud connections (`*.convex.cloud`, `wss://*.convex.cloud`)
  - Allows Google Fonts (used by next/font)
  - Blocks iframing (`frame-ancestors 'none'`)
- Removed stale Supabase remote patterns from images config

### Task 2: Clean next.config.js (DEPL-01)
- Removed stale `images.remotePatterns` for Supabase (no longer used)
- Removed `experimental.turbotrace` (development only)
- Simplified webpack config (removed unused `isServer` param)

### Task 3: Health check endpoint (DEPL-05)
- Created `src/app/api/health/route.ts`
- Returns `{ status: 'ok', timestamp, version }` with 200
- `Cache-Control: no-store` to prevent stale health checks

### Task 4: Custom 404 page (DEPL-06)
- Created `src/app/not-found.tsx` with HV Consultores branding
- Shows 404 code with gradient text
- Links to landing page and dashboard
- Uses project's design tokens and typography

### Task 5: Custom 500 page (DEPL-06)
- Created `src/app/global-error.tsx` as error boundary
- Uses inline styles (can't depend on CSS loading during errors)
- "Reintentar" button calls `reset()` to retry the render
- HV Consultores branding in navy blue

### Task 6: Env variable documentation (DEPL-02) — already existed
- `.env.example` already documents all variables
- `.env.production.example` exists for production deployment

### Task 7: Bundle optimization (DEPL-04) — done in Phase 5
- Dynamic imports for heavy modules verified in Phase 5

## Files Changed
- MOD: `next.config.js` (security headers, cleanup)
- NEW: `src/app/api/health/route.ts`
- NEW: `src/app/not-found.tsx`
- NEW: `src/app/global-error.tsx`

## Verification
- `npx tsc --noEmit` → 0 errors
- `npm run build` → clean pass
- `/api/health` renders as static route (prerendered)
